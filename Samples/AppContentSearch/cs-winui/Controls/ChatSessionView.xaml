<UserControl 
    x:Class="Notes.Controls.ChatSessionView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="using:Notes.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:viewModel="using:Notes.ViewModels"
    xmlns:local="using:Notes"
    mc:Ignorable="d">

    <Grid
        Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
        BorderThickness="1"
        RowDefinitions="Auto,*, Auto"
        Padding="4"
        VerticalAlignment="Stretch">

        <Button Click="clearChatButton_Click"
                Style="{StaticResource SubtleButtonStyle}"
                HorizontalAlignment="Right"
                VerticalAlignment="Top"
                Margin="4,4,12,4"
                ToolTipService.ToolTip="Clear chat">
            <Button.Content>
                <FontIcon Glyph="&#xE72C;" FontSize="16"/>
            </Button.Content>
        </Button>

        <ListView
            Grid.Row="1"
            ItemsSource="{x:Bind ChatSessionViewModel.SessionEntryViewModels, Mode=TwoWay}"
            SelectionMode="None">
            <ListView.ItemsPanel>
                <ItemsPanelTemplate>
                    <ItemsStackPanel ItemsUpdatingScrollMode="KeepLastItemInView" />
                </ItemsPanelTemplate>
            </ListView.ItemsPanel>
            <ListView.ItemTemplate>
                <DataTemplate x:DataType="viewModel:SessionEntryViewModel">
                    <Grid Grid.RowDefinitions="Auto, Auto">
                        <!-- Main Message -->
                        <Grid
                            Background="{x:Bind BackgroundBrush}"
                            HorizontalAlignment="{x:Bind HorizontalAlignment}"
                            Margin="{x:Bind Margin}"
                            CornerRadius="{ThemeResource OverlayCornerRadius}"
                            Padding="12,8">
                            <TextBlock
                                Text="{x:Bind Message, Mode=OneWay}"
                                Foreground="{x:Bind ForegroundBrush}"
                                TextWrapping="Wrap" />
                        </Grid>

                        <!-- Reference List -->
                        <StackPanel Grid.Row="1" Margin="0,12">
                            <ItemsRepeater
                                ItemsSource="{x:Bind ReferencedFiles}">
                                <ItemsRepeater.Layout>
                                    <LinedFlowLayout LineSpacing="3" MinItemSpacing="3"/>
                                </ItemsRepeater.Layout>
                                <ItemsRepeater.ItemTemplate>
                                    <DataTemplate x:DataType="local:SearchResult">
                                        <Button Tag="{x:Bind}"
                                             CornerRadius="8"
                                             Padding="8, 2"
                                             MaxWidth="200"
                                             Height="28"
                                            Click="OnReferenceClick">
                                            <StackPanel Orientation="Horizontal">
                                                <FontIcon 
                                                 FontFamily="Segoe UI Emoji"
                                                 FontSize="14"
                                                 Glyph="{x:Bind local:SearchResult.ContentTypeToGlyph(ContentType)}" />
                                                <TextBlock 
                                                 Margin="4, 0, 0, 0"
                                                 Text="{x:Bind Title}"
                                                 FontSize="12"
                                                 VerticalAlignment="Center"
                                                 MaxWidth="130"
                                                 TextWrapping="WrapWholeWords"
                                                 MaxLines="2"
                                                 TextTrimming="WordEllipsis" />
                                            </StackPanel>
                                        </Button>
                                    </DataTemplate>
                                </ItemsRepeater.ItemTemplate>
                            </ItemsRepeater>
                        </StackPanel>
                    </Grid>
                </DataTemplate>
            </ListView.ItemTemplate>
            <ListView.ItemContainerTransitions>
                <TransitionCollection />
            </ListView.ItemContainerTransitions>
        </ListView>

        <Grid
            Grid.Row="2"
            HorizontalAlignment="Stretch"
            VerticalAlignment="Bottom"
            ColumnDefinitions="*, Auto">
            <TextBox 
                x:Name="txtRequest"
                HorizontalAlignment="Stretch"
                PlaceholderText="Ask Your Documents"
                TextWrapping="Wrap"
                Padding="7"
                Margin="2" />
            <Button x:Name="siSend"
                    AllowFocusOnInteraction="False"
                    ToolTipService.ToolTip="Send (Enter)"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Bottom"
                    Margin="4"
                    Style="{StaticResource SubtleButtonStyle}">
                <FontIcon FontSize="16"
                          Glyph="&#xE724;" />
            </Button>
        </Grid>
    </Grid>
</UserControl>
